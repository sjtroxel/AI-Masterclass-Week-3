---
name: ai-ci-onboard
description: Set up AI-ready CI/CD pipelines for a project — Claude Code PR review, secret scanning (gitleaks), dependency updates (dependabot), and optional label-based Specify→Plan→Develop workflow. Companion to ai-onboard. Use when a project needs GitHub Actions automation for AI-assisted development.
---

# AI CI Onboard

Set up CI/CD pipelines that integrate AI into your development workflow. This is a companion to `/ai-onboard` — run that first for CLAUDE.md, rules, and docs, then run this for GitHub Actions automation.

**TARGET**: $ARGUMENTS (defaults to current working directory)
**Scratch dir**: `.ai-ci-onboard-scratch/` in project root — agents communicate here between phases.

## Setup

Before Phase 1, resolve the skill path:
- `SKILL_PATH` = the directory containing this skill file (`~/.claude/skills/ai-ci-onboard/` by default, or the path where this skill is installed)
- Use `SKILL_PATH` wherever `[skill-path]` appears in these instructions

---

## Phase 1 — Discovery

`Task(subagent_type="general-purpose", model="sonnet")`

> You are running a CI/CD discovery scan on a codebase before generating GitHub Actions workflows.
>
> Project root: [TARGET or cwd]
>
> 1. **Create scratch dir** — `mkdir -p [TARGET]/.ai-ci-onboard-scratch` and add `.ai-ci-onboard-scratch/` to `.gitignore` if not already present (same pattern as ai-onboard's init_scratch.sh).
> 2. **Check for `.github/workflows/`** — list any existing workflow files, read each one, and summarize what it does (trigger, purpose).
> 3. **Check for `dependabot.yml` or `dependabot.yaml`** — in `.github/` directory.
> 4. **Check for `package.json` scripts** — specifically `test`, `lint`, `build`, `format`, `typecheck` commands. Also check `Makefile`, `composer.json` scripts, `Cargo.toml`, `pyproject.toml` for equivalent commands.
> 5. **Detect primary language/framework** — from file extensions, config files, lock files.
> 6. **Detect package ecosystem** — npm, pip, cargo, composer, bundler, gomod, etc. (for dependabot config).
> 7. **Check if project uses GitHub** — read `.git/config` for remote URL, confirm it's github.com.
> 8. **Write findings to `.ai-ci-onboard-scratch/discovery.md`** with sections: Platform, Existing Workflows, Package Ecosystem, Test/Lint/Build Commands, Language/Framework.
>
> Return: platform detected (GitHub/other), existing workflows summary, test/lint/build commands found, package ecosystem.

---

## Phase 2 — User Selection

Inline (no Task — run in main context).

Use **AskUserQuestion**:

- **Q1** (multiSelect): "Which CI/CD workflows should I generate?"
  - `claude-review.yml` — Claude Code reviews every PR for bugs, security, and convention adherence
  - `gitleaks.yml` — Secret scanning on every push and PR (catches hardcoded credentials)
  - `dependabot.yml` — Automated dependency update PRs (security patches, version bumps)
  - `label-workflow.yml` — Label-based Specify→Plan→Develop pipeline with human approval gates (3 workflow files)

- **Q2** (single select): "Which branch should CI target?"
  - `main`
  - `master`
  - `develop`

Write selections to `.ai-ci-onboard-scratch/user-input.md`:
```markdown
## Selected Workflows
- [list of selected workflow names]

## Target Branch
- [branch name]
```

---

## Phase 3 — Generation

`Task(subagent_type="general-purpose", model="sonnet")`

> You are generating GitHub Actions workflow files for AI-assisted CI/CD.
>
> Read `.ai-ci-onboard-scratch/discovery.md` and `.ai-ci-onboard-scratch/user-input.md`.
> Read `[skill-path]/references/workflow-templates.md` for all workflow templates.
>
> For each selected workflow:
> - Generate the file using the template from workflow-templates.md
> - Customize with discovered test/lint/build commands and target branch
> - Replace `[BRANCH]` placeholders with the user's selected branch
> - Replace `[ECOSYSTEM]` in dependabot with the detected package ecosystem
> - For `dependabot.yml` — write to `.github/dependabot.yml`
> - For all workflow `.yml` files — write to `.github/workflows/`
> - For `label-workflow.yml` — this generates 3 separate files: `claude-specify.yml`, `claude-plan.yml`, `claude-develop.yml`
> - Create `.github/workflows/` directory if it doesn't exist
> - Add a comment at the top of each generated file: `# Generated by ai-ci-onboard skill — customize as needed`
> - After writing each file, note the filepath and a 1-sentence summary
>
> Write list of generated files to `.ai-ci-onboard-scratch/generated-files.md`.
>
> Return: list of all generated files with summaries.

---

## Phase 4 — Summary & Cleanup

Inline (no separate Task).

- Read `.ai-ci-onboard-scratch/generated-files.md`
- Output summary of all generated files with their paths and purposes
- Required next steps:
  1. **Add `ANTHROPIC_API_KEY` to GitHub repository secrets** — Settings → Secrets and variables → Actions → New repository secret
  2. **Review generated workflows** and customize prompts/triggers as needed
  3. **If label-workflow was selected**: Create the required labels in your GitHub repo: `needs:specify`, `review:specify`, `needs:plan`, `review:plan`, `needs:develop`, `review:develop`
  4. **Commit the `.github/` changes** to version control
- Run cleanup: `bash [skill-path]/scripts/cleanup.sh [TARGET]`

---

## Orchestration Rules

- Sequential phases — never start before previous completes
- Scratch dir is the state bus between phases
- Phase 3 uses sonnet — templates are well-defined, customization is straightforward
